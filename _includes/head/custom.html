<meta name="color-scheme" content="dark">
{%- comment -%}
  Tailwind build output (assets/css/main.css).
  Load first so site.css/custom.css can intentionally override base styles.
  Enable globally or per-page via front matter: `tailwind: true`.
{%- endcomment -%}
<link rel="stylesheet" href="{{ '/assets/css/site.css' | relative_url }}">
<link rel="stylesheet" href="{{ '/assets/css/custom.css' | relative_url }}">
<link rel="stylesheet" href="{{ '/assets/css/code-badge.css' | relative_url }}">
<link rel="stylesheet" href="{{ '/assets/css/syntax.css' | relative_url }}">
<script defer src="{{ '/assets/js/code-badge.js' | relative_url }}"></script>
<script defer src="{{ '/assets/js/header.js' | relative_url }}"></script>

{%- comment -%}
  React + react-three-fiber bundle (optional per-page):
  Enable with `react: true` in page front matter (or site.react in _config.yml).
  It auto-mounts into any element with `[data-r3f-canvas]`.
{%- endcomment -%}
{% if page.react or site.react %}
<script>
  // Minimal browser polyfills for packages expecting Node globals
  window.global = window.global || window;
  window.process = window.process || { env: { NODE_ENV: 'production' } };
  // Some libraries read process.env.NODE_ENV specifically; make sure it's set
  if (!window.process.env) window.process.env = { NODE_ENV: 'production' };
  if (!window.process.env.NODE_ENV) window.process.env.NODE_ENV = 'production';
  // Ensure Buffer is not accidentally referenced (not provided)
</script>
<script defer src="{{ '/assets/react-dist/site-react-app.js' | relative_url }}"></script>
{% endif %}

{% comment %}
  MathJax (GitHub Pagesâ€“safe):
  - Enable per page with `math: true` in front matter, or site-wide by setting `math: true` in _config.yml.
  - This avoids relying on custom plugins (which GitHub Pages ignores in safe mode).
{% endcomment %}
{% if page.math or site.math %}
<script>
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      displayMath: [['$$','$$'], ['\\[','\\]']],
      processEscapes: true,
      tags: 'ams'
    },
    options: { skipHtmlTags: ['script','noscript','style','textarea','pre','code'] }
  };
  // Prevent duplicate loads if injected elsewhere
  if (!document.getElementById('mathjax-script')) {
    const s = document.createElement('script');
    s.id = 'mathjax-script'; s.async = true;
    s.src = 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js';
    document.head.appendChild(s);
  }
  </script>
{% endif %}

{% if page.private_password %}
<meta name="private-password" content="{{ page.private_password | escape }}">
{% endif %}

{% if page.private_title %}<meta name="private-title" content="{{ page.private_title | escape }}">{% endif %}
{% if page.private_remember %}<meta name="private-remember" content="{{ page.private_remember | escape }}">{% endif %}

{%- comment -%}
  Load Tailwind last so its utilities have higher precedence than generic site rules.
  Preflight is disabled in tailwind.config.js to avoid resetting base styles.
{%- endcomment -%}
{% if site.tailwind or page.tailwind %}
<link rel="stylesheet" href="{{ '/assets/css/main.css' | relative_url }}">
{% endif %}
